<!DOCTYPE html>
<html>
  <head>
    <title>Manage Family Members</title>
  </head>
  <style>
    /* Page container */
    .family-page {
      max-width: 900px;
      margin: 30px auto;
      padding: 24px;
      background: #ffffff;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.06);
      font-family: Inter, system-ui, sans-serif;
    }

    /* Title */
    .page-title {
      margin-bottom: 20px;
      font-size: 22px;
      font-weight: 700;
      color: #4a148c;
    }

    /* Form */
    .family-form {
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-bottom: 24px;
    }

    /* Grid for inputs */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    /* Inputs */
    .form-grid input,
    .form-grid select {
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 14px;
      transition: border 0.2s, box-shadow 0.2s;
    }

    .form-grid input:focus,
    .form-grid select:focus {
      outline: none;
      border-color: #6a1b9a;
      box-shadow: 0 0 0 3px rgba(106, 27, 154, 0.12);
    }

    /* Primary button */
    .btn-primary {
      align-self: flex-start;
      padding: 10px 18px;
      background: linear-gradient(135deg, #4a148c, #6a1b9a);
      color: #fff;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 6px 18px rgba(74, 20, 140, 0.25);
    }

    .btn-primary:hover {
      opacity: 0.95;
    }

    /* Family list */
    .family-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }

    /* Member card */
    .family-list div {
      padding: 12px 14px;
      border-radius: 10px;
      background: #f7f8fc;
      font-size: 14px;
      border-left: 4px solid #6a1b9a;
    }

    /* Back button */
    .btn-secondary {
      padding: 8px 14px;
      background: transparent;
      border: 1px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
    }

    .btn-secondary:hover {
      background: #f2f2f2;
    }

    /* Mobile responsiveness */
    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    @media (max-width: 480px) {
      .form-grid {
        grid-template-columns: 1fr;
      }

      .btn-primary {
        width: 100%;
      }
    }
  </style>
  <body>
  <div class="family-page">
  <h2 class="page-title">üë®‚Äçüë©‚Äçüëß Family Members</h2>

  <form id="familyForm" class="family-form">
    <div class="form-grid">
      <input type="text" id="familyName" placeholder="Full Name" required />
      <input type="text" id="familyRelation" placeholder="Relation" required />
      <input type="number" id="familyAge" placeholder="Age" required />
      <select id="familyGender" required>
        <option value="">Gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
      </select>
    </div>

    <button type="submit" class="btn-primary">‚ûï Add Member</button>
  </form>

  <div id="familyList" class="family-list"></div>

  <button class="btn-secondary" onclick="goBack()">‚Üê Back to Dashboard</button>
</div>


    <script>
      const user = JSON.parse(localStorage.getItem("user"));
      if (!user) {
        alert("Please login first");
        window.location.href = "login.html";
      }

      const mobile = user.mobile;
      const familyList = document.getElementById("familyList");

      function goBack() {
        window.location.href = "patient-dashboard.html";
      }

      // ‚úÖ HANDLE ADD FAMILY MEMBER
      familyForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const name = document.getElementById("familyName").value.trim();
        const relation = document.getElementById("familyRelation").value.trim();
        const age = Number(document.getElementById("familyAge").value);
        const gender = document.getElementById("familyGender").value;

        if (!name || !relation || !age || !gender) {
          alert("Please fill all fields");
          return;
        }

        try {
          const res = await fetch(
            "https://jainsewa-backend.onrender.com/api/add-family-member",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                mobile,
                name,
                relation,
                age,
                gender,
              }),
            }
          );

          const data = await res.json();
          if (!res.ok) throw new Error(data.message);

          alert("‚úÖ Family member added successfully");

          // Optional: show added member on this page
          const div = document.createElement("div");
          div.textContent = `${name} (${relation}) - ${age}, ${gender}`;
          familyList.appendChild(div);

          familyForm.reset();

          // ‚úÖ Redirect back so dashboard reloads fresh data
          setTimeout(() => {
            window.location.href = "patient-dashboard.html";
          }, 500);
        } catch (err) {
          console.error(err);
          alert("‚ùå Failed to add family member");
        }
      });
    </script>
  </body>
</html>
