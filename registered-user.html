<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Registered Users</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
    input, button { padding: 5px; margin: 5px; }
    .blocked { background-color: #fdd; }
  </style>
</head>
<body>
  <h2>Registered Users</h2>

  <div>
    <input type="text" id="searchInput" placeholder="Search by name, email, mobile">
    <button id="searchBtn">Search</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Mobile</th>
        <th>Email</th>
        <th>Gender</th>
        <th>DOB</th>
        <th>City</th>
        <th>State</th>
        <th>Disease</th>
        <th>Role</th>
        <th>Blocked</th>
        <th>Registered At</th>
      </tr>
    </thead>
    <tbody id="usersTable"></tbody>
  </table>

  <script>
    const usersTable = document.getElementById('usersTable');
    const searchBtn = document.getElementById('searchBtn');
    const searchInput = document.getElementById('searchInput');

    async function fetchUsers(search = '') {
      try {
        const url = `https://jainsewa-backend.onrender.com/api/admin/users${search ? '?search=' + encodeURIComponent(search) : ''}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error("Failed to fetch users");
        const data = await res.json();

        usersTable.innerHTML = '';
        if (data.length === 0) {
          usersTable.innerHTML = `<tr><td colspan="11">No users found</td></tr>`;
          return;
        }

        data.forEach(u => {
          const row = `<tr class="${u.blocked ? 'blocked' : ''}">
            <td>${u.firstName} ${u.lastName}</td>
            <td>${u.mobile}</td>
            <td>${u.email || '-'}</td>
            <td>${u.gender}</td>
            <td>${u.dob}</td>
            <td>${u.city || '-'}</td>
            <td>${u.state || '-'}</td>
            <td>${u.disease || '-'}</td>
            <td>${u.role}</td>
            <td>${u.blocked ? 'Yes' : 'No'}</td>
            <td>${new Date(u.createdAt).toLocaleString()}</td>
          </tr>`;
          usersTable.innerHTML += row;
        });
      } catch (err) {
        console.error(err);
        alert('Error fetching users');
      }
    }

    searchBtn.addEventListener('click', () => fetchUsers(searchInput.value));

    // Initial load
    fetchUsers();
  </script>
</body>
</html>
